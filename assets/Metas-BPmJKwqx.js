import{c as _,h as F,r as u,j as e,P as E,a as V,$ as j}from"./index-B2eCoH1P.js";import{C as y,a as w,b as P,c as M}from"./card-BcAP0yC-.js";import{B}from"./button-DQnByZSr.js";import{U}from"./users-D0UN_CPM.js";/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=_("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);var v="Progress",b=100,[T,ae]=F(v),[O,G]=T(v),R=u.forwardRef((a,r)=>{const{__scopeProgress:c,value:l=null,max:t,getValueLabel:g=H,...m}=a;(t||t===0)&&!C(t)&&console.error(X(`${t}`,"Progress"));const n=C(t)?t:b;l!==null&&!$(l,n)&&console.error(J(`${l}`,"Progress"));const i=$(l,n)?l:null,h=p(i)?g(i,n):void 0;return e.jsx(O,{scope:c,value:i,max:n,children:e.jsx(E.div,{"aria-valuemax":n,"aria-valuemin":0,"aria-valuenow":p(i)?i:void 0,"aria-valuetext":h,role:"progressbar","data-state":I(i,n),"data-value":i??void 0,"data-max":n,...m,ref:r})})});R.displayName=v;var S="ProgressIndicator",z=u.forwardRef((a,r)=>{const{__scopeProgress:c,...l}=a,t=G(S,c);return e.jsx(E.div,{"data-state":I(t.value,t.max),"data-value":t.value??void 0,"data-max":t.max,...l,ref:r})});z.displayName=S;function H(a,r){return`${Math.round(a/r*100)}%`}function I(a,r){return a==null?"indeterminate":a===r?"complete":"loading"}function p(a){return typeof a=="number"}function C(a){return p(a)&&!isNaN(a)&&a>0}function $(a,r){return p(a)&&!isNaN(a)&&a<=r&&a>=0}function X(a,r){return`Invalid prop \`max\` of value \`${a}\` supplied to \`${r}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${b}\`.`}function J(a,r){return`Invalid prop \`value\` of value \`${a}\` supplied to \`${r}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${b} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var k=R,K=z;const Q=u.forwardRef(({className:a,value:r,...c},l)=>e.jsx(k,{ref:l,className:V("relative h-4 w-full overflow-hidden rounded-full bg-secondary",a),...c,children:e.jsx(K,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(r||0)}%)`}})}));Q.displayName=k.displayName;function se(){const[a,r]=u.useState([]),[c,l]=u.useState(!1),[t,g]=u.useState(1e5),[m,n]=u.useState(0);u.useEffect(()=>{i()},[]);async function i(){l(!0);try{const{data:s,error:o}=await j.from("agents").select("*");if(o)console.error("[Metas] buscarCorretores failed",o);else{const x=(s||[]).map(d=>({...d,meta:d.meta||0,realizado:d.realizado||0}));r(x),n(x.reduce((d,A)=>d+(A.realizado||0),0))}}catch(s){console.error("[Metas] buscarCorretores threw",s)}finally{l(!1)}}function h(s,o){r(x=>x.map(d=>d.id===s?{...d,meta:parseFloat(o)||0}:d))}function q(s){g(parseFloat(s)||0)}async function L(){l(!0);try{const s=a.map(o=>j.from("agents").update({meta:o.meta}).eq("id",o.id));await Promise.all(s),alert("Metas salvas com sucesso!")}catch(s){console.error("[Metas] salvarMetas threw",s),alert("Falha ao salvar metas.")}finally{l(!1)}}function N(s){return s<50?"bg-gradient-to-r from-red-400 to-red-600":s<80?"bg-gradient-to-r from-yellow-300 to-yellow-500":"bg-gradient-to-r from-green-400 to-green-600"}function f(s,o){return!s||s===0?0:Math.min(100,o/s*100)}return e.jsxs("div",{className:"p-6 max-w-5xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8 text-primary",children:"Metas da Equipe e Corretores"}),e.jsxs(y,{className:"mb-8 shadow-lg bg-gradient-to-br from-blue-800 to-blue-900 text-white",children:[e.jsxs(w,{className:"flex flex-row items-center gap-4",children:[e.jsx(U,{size:40,className:"text-blue-300"}),e.jsx(P,{className:"text-2xl font-bold",children:"Meta da Equipe"})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:gap-8 mb-4",children:[e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Meta:"}),e.jsx("input",{type:"number",value:t,onChange:s=>q(s.target.value),className:"border rounded px-2 py-1 w-40 text-black font-bold",min:0})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Alcançado:"}),e.jsxs("span",{className:"text-2xl font-bold text-green-300",children:["R$ ",m.toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex flex-col gap-1",children:[e.jsx("span",{className:"text-lg font-semibold",children:"Progresso:"}),e.jsxs("span",{className:"text-2xl font-bold",children:[f(t,m).toFixed(1),"%"]})]})]}),e.jsx("div",{className:"w-full h-6 rounded bg-gray-700",children:e.jsx("div",{className:`h-6 rounded transition-all duration-500 ${N(f(t,m))}`,style:{width:`${f(t,m)}%`}})})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:a.map(s=>{const o=f(s.meta,s.realizado);return e.jsxs(y,{className:"shadow-md bg-gradient-to-br from-slate-100 to-blue-100",children:[e.jsxs(w,{className:"flex flex-row items-center gap-3",children:[e.jsx(D,{size:28,className:"text-blue-500"}),e.jsx(P,{className:"text-lg font-bold text-blue-900",children:s.nome})]}),e.jsxs(M,{children:[e.jsxs("div",{className:"flex flex-col gap-2 mb-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Meta:"}),e.jsx("input",{type:"number",value:s.meta,onChange:x=>h(s.id,x.target.value),className:"border rounded px-2 py-1 w-24 text-black font-bold",min:0})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Alcançado:"}),e.jsxs("span",{className:"font-bold text-green-700",children:["R$ ",s.realizado.toLocaleString("pt-BR")]})]}),e.jsxs("div",{className:"flex gap-2 items-center",children:[e.jsx("span",{className:"text-sm font-semibold",children:"Progresso:"}),e.jsxs("span",{className:"font-bold text-blue-700",children:[o.toFixed(1),"%"]})]})]}),e.jsx("div",{className:"w-full h-4 rounded bg-gray-300",children:e.jsx("div",{className:`h-4 rounded transition-all duration-500 ${N(o)}`,style:{width:`${o}%`}})})]})]},s.id)})}),e.jsx("div",{className:"flex justify-end mt-8",children:e.jsx(B,{onClick:L,disabled:c,className:"px-8 py-3 text-lg bg-blue-700 hover:bg-blue-800",children:c?"Salvando...":"Salvar Metas"})})]})}export{se as default};
