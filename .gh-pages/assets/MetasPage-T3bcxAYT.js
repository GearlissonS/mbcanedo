import{r as d,Z as o,j as t}from"./index-B1T0EHdw.js";function y(){const[u,g]=d.useState([]),[l,h]=d.useState([]);d.useEffect(()=>{n()},[]);async function n(){try{const{data:r,error:i}=await o.from("equipes").select("*");i&&console.error("[MetasPage] carregarDados equipes failed",i),g(r||[]);const{data:a,error:e}=await o.from("corretores").select("*");e&&console.error("[MetasPage] carregarDados corretores failed",e),h(a||[])}catch(r){console.error("[MetasPage] carregarDados threw",r)}}async function m(r,i){try{const{error:a}=await o.from("equipes").update({meta_equipe:i}).eq("id",r);a&&console.error("[MetasPage] atualizarMetaEquipe failed",a)}catch(a){console.error("[MetasPage] atualizarMetaEquipe threw",a)}finally{n()}}async function p(r,i){try{const{error:a}=await o.from("corretores").update({meta_individual:i}).eq("id",r);a&&console.error("[MetasPage] atualizarMetaCorretor failed",a)}catch(a){console.error("[MetasPage] atualizarMetaCorretor threw",a)}finally{n()}}function c(r,i){return!i||i===0?0:Math.min(100,(r||0)/i*100)}return t.jsxs("div",{style:{padding:20},children:[t.jsx("h2",{children:"Metas"}),u.map(r=>{const i=l.filter(e=>e.equipe===r.nome).reduce((e,s)=>e+(s.realizado||0),0),a=c(i,r.meta_equipe);return t.jsxs("div",{style:{marginBottom:30},children:[t.jsxs("h3",{children:[r.nome," - Meta da Equipe"]}),t.jsx("input",{type:"number",value:r.meta_equipe||0,onChange:e=>m(r.id,Number(e.target.value))}),t.jsx("div",{style:{background:"#eee",borderRadius:4,height:20,marginTop:5},children:t.jsx("div",{style:{width:`${a}%`,background:a>=100?"green":"blue",height:"100%",borderRadius:4,transition:"width 0.3s ease"}})}),t.jsxs("p",{children:[a.toFixed(1),"% (",i,"/",r.meta_equipe,")"]}),t.jsx("h4",{children:"Corretores"}),l.filter(e=>e.equipe===r.nome).map(e=>{const s=c(e.realizado,e.meta_individual);return t.jsxs("div",{style:{marginBottom:10},children:[t.jsx("strong",{children:e.nome}),t.jsx("input",{type:"number",value:e.meta_individual||0,onChange:f=>p(e.id,Number(f.target.value)),style:{marginLeft:10}}),t.jsx("div",{style:{background:"#eee",borderRadius:4,height:10,marginTop:5},children:t.jsx("div",{style:{width:`${s}%`,background:s>=100?"green":"orange",height:"100%",borderRadius:4,transition:"width 0.3s ease"}})}),t.jsxs("span",{children:[s.toFixed(1),"% (",e.realizado,"/",e.meta_individual,")"]})]},e.id)})]},r.id)})]})}export{y as default};
